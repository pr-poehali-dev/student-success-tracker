import { useEffect } from 'react';
import * as XLSX from 'xlsx';

export default function DownloadTeamsImportTemplate() {
  useEffect(() => {
    const createTemplate = () => {
      const workbook = XLSX.utils.book_new();

      const templateData = [
        {
          "Игра": "valheim",
          "Команда 1": "Викинги",
          "Цвет команды 1": "#FDE2E4",
          "Класс команды 1": "5А",
          "Ученики команды 1": "Иван Иванов, Петр Петров",
          "Команда 2": "Берсерки",
          "Цвет команды 2": "#D9E7FF",
          "Класс команды 2": "5Б",
          "Ученики команды 2": "Анна Сидорова, Мария Козлова",
          "Лига": "premiere",
          "Дата": "2024-03-15",
          "Время": "14:00"
        },
        {
          "Игра": "civilization",
          "Команда 1": "Римляне",
          "Цвет команды 1": "#FFF4CC",
          "Класс команды 1": "6А",
          "Ученики команды 1": "Сергей Смирнов, Ольга Новикова",
          "Команда 2": "Греки",
          "Цвет команды 2": "#D4F1D4",
          "Класс команды 2": "6Б",
          "Ученики команды 2": "Дмитрий Федоров, Елена Морозова",
          "Лига": "beginner",
          "Дата": "2024-03-16",
          "Время": "15:00"
        }
      ];

      const worksheet = XLSX.utils.json_to_sheet(templateData);

      worksheet['!cols'] = [
        { wch: 12 },
        { wch: 15 },
        { wch: 18 },
        { wch: 18 },
        { wch: 30 },
        { wch: 15 },
        { wch: 18 },
        { wch: 18 },
        { wch: 30 },
        { wch: 15 },
        { wch: 12 },
        { wch: 10 }
      ];

      XLSX.utils.book_append_sheet(workbook, worksheet, "Матчи");

      const instructionsData = [
        {
          "Поле": "Игра",
          "Описание": "Тип игры (valheim, civilization, factorio, sport, robo, 3dphysics, lumocity)",
          "Пример": "valheim"
        },
        {
          "Поле": "Команда 1",
          "Описание": "Название первой команды",
          "Пример": "Викинги"
        },
        {
          "Поле": "Цвет команды 1",
          "Описание": "HEX цвет карточки команды 1",
          "Пример": "#FF5733"
        },
        {
          "Поле": "Класс команды 1",
          "Описание": "Название класса для фильтрации учеников (необязательно)",
          "Пример": "5А"
        },
        {
          "Поле": "Ученики команды 1",
          "Описание": "ФИО учеников через запятую",
          "Пример": "Иван Иванов, Петр Петров"
        },
        {
          "Поле": "Команда 2",
          "Описание": "Название второй команды",
          "Пример": "Берсерки"
        },
        {
          "Поле": "Цвет команды 2",
          "Описание": "HEX цвет карточки команды 2",
          "Пример": "#33C1FF"
        },
        {
          "Поле": "Класс команды 2",
          "Описание": "Название класса для фильтрации учеников (необязательно)",
          "Пример": "5Б"
        },
        {
          "Поле": "Ученики команды 2",
          "Описание": "ФИО учеников через запятую",
          "Пример": "Анна Сидорова, Мария Козлова"
        },
        {
          "Поле": "Лига",
          "Описание": "Название лиги: beginner, second, first, premiere",
          "Пример": "beginner"
        },
        {
          "Поле": "Дата",
          "Описание": "Дата матча в формате YYYY-MM-DD",
          "Пример": "2024-03-15"
        },
        {
          "Поле": "Время",
          "Описание": "Время матча в формате HH:MM",
          "Пример": "14:00"
        }
      ];

      const instructionsSheet = XLSX.utils.json_to_sheet(instructionsData);
      instructionsSheet['!cols'] = [
        { wch: 20 },
        { wch: 60 },
        { wch: 25 }
      ];
      XLSX.utils.book_append_sheet(workbook, instructionsSheet, "Инструкция");

      const colorsData = [
        { "Название": "Белый", "Код цвета": "#FFFFFF" },
        { "Название": "Розовый", "Код цвета": "#FDE2E4" },
        { "Название": "Персиковый", "Код цвета": "#FFE5D9" },
        { "Название": "Желтый", "Код цвета": "#FFF4CC" },
        { "Название": "Зеленый", "Код цвета": "#D4F1D4" },
        { "Название": "Голубой", "Код цвета": "#D9E7FF" },
        { "Название": "Фиолетовый", "Код цвета": "#E8DAFF" },
        { "Название": "Серый", "Код цвета": "#F3F4F6" },
        { "Название": "Красный", "Код цвета": "#FECACA" },
        { "Название": "Оранжевый", "Код цвета": "#FED7AA" },
        { "Название": "Лаймовый", "Код цвета": "#D9F99D" },
        { "Название": "Бирюзовый", "Код цвета": "#A5F3FC" }
      ];

      const colorsSheet = XLSX.utils.json_to_sheet(colorsData);
      colorsSheet['!cols'] = [
        { wch: 20 },
        { wch: 15 }
      ];
      XLSX.utils.book_append_sheet(workbook, colorsSheet, "Доступные цвета");

      const leaguesData = [
        { "Код лиги": "beginner", "Название": "Beginner League", "Описание": "Начальная лига для новичков" },
        { "Код лиги": "second", "Название": "Second League", "Описание": "Вторая лига" },
        { "Код лиги": "first", "Название": "First League", "Описание": "Первая лига" },
        { "Код лиги": "premiere", "Название": "Premiere League", "Описание": "Премьер-лига для опытных игроков" }
      ];

      const leaguesSheet = XLSX.utils.json_to_sheet(leaguesData);
      leaguesSheet['!cols'] = [
        { wch: 15 },
        { wch: 20 },
        { wch: 40 }
      ];
      XLSX.utils.book_append_sheet(workbook, leaguesSheet, "Доступные лиги");

      XLSX.writeFile(workbook, 'Шаблон_импорта_команд.xlsx');
    };

    createTemplate();
    
    setTimeout(() => {
      window.close();
    }, 1000);
  }, []);

  return (
    <div style={{ padding: '40px', textAlign: 'center', fontFamily: 'system-ui' }}>
      <h1 style={{ fontSize: '24px', marginBottom: '16px' }}>Скачивание шаблона...</h1>
      <p style={{ color: '#666' }}>Файл скачивается автоматически. Окно закроется через секунду.</p>
    </div>
  );
}